/*
 * Expandable, a jQuery plugin to dynamically group and hide web content
 * Copyright (C) 2009  Marc Diethelm
 * License: (GPL 3, http://www.gnu.org/licenses/gpl-3.0.txt) see license.txt
 */
(function($){$.fn.expandable=function(){var action;var userOptions={};if(arguments.length==1){action=(arguments[0].constructor==String?arguments[0]:null);userOptions=(arguments[0].constructor==Object?arguments[0]:null);}else{if(arguments.length==2){action=(arguments[0].constructor==String?arguments[0]:null);userOptions=arguments[1];}}var options=$.extend({},$.fn.expandable.defaults,userOptions);var currentValues={};if(options.textOptions!=null){try{currentValues=JSON.parse($(options.textOptions).val());}catch(e){currentValues={};}}options=$.extend(options,currentValues);return this.each(function(){if(action=="destroy"){$(this).removeClass("ui-widget ui-expandable ui-expandable-open");$(".ui-widget-content",this).remove().contents().appendTo(this);if($(this).data("elTitle")){$(".ui-widget-header",this).unbind("click").remove();$(this).prepend($(this).data("elTitle"));}return this;}else{if(action=="close"){this.closeExpandable();return this;}else{if(action=="open"){this.openExpandable(null,options);return this;}}}$(this).hide().addClass("ui-expandable ui-widget");var title="";if($(".ui-expandable-title",this).length>0){var $title=$(".ui-expandable-title",this).eq(0).remove();title=$title.text();$(this).data("elTitle",$title);delete $title;}title=options.title||title;if($(".ui-widget-content",this).length==0){var html='<div class="ui-widget-content ui-helper-clearfix"></div>';var $this=jQuery(this);if($this.contents().length){$this.contents().wrapAll(html);}else{$this.html(html);}}var $content=$(".ui-widget-content",this);if(options.startopen){$(this).addClass("ui-expandable-open");}else{$content.hide();}if(options.uiIconClosed&&options.uiIconOpen){var iconstartclass=(options.startopen?options.uiIconOpen:options.uiIconClosed);var iconclosedclass=options.uiIconClosed;var iconopenclass=options.uiIconOpen;}else{var iconstartclass=(options.startopen?"icon-open":"icon-closed");var iconclosedclass="icon-closed";var iconopenclass="icon-open";}var extra_icon="";if(options.extraIcon){extra_icon=" ui-icon "+options.extraIcon;}var $title=$('<div class="ui-state-default ui-widget-header" title="'+options.tooltip+'">	<div class="ui-expandable-icon ui-icon '+iconstartclass+'"></div>	<div class="ui-expandable-title">'+title+'</div>	<div class="ui-expandable-extraIcon'+extra_icon+'"></div></div>');$(".ui-widget-header",this).length?$(".ui-widget-header",this).replaceWith($title):$(this).prepend($title);$(this).show();var $icon=$(".ui-icon",this);var y_offset=Math.floor((($title.innerHeight()-$icon.height())/2));if(y_offset>0){$icon.css("margin-top",y_offset);}var $expandable=$(this);var $self=this;if(options.close){this._close=options.close;}if(options.open){this._open=options.open;}$title.bind("click",null,function(event){if($expandable.hasClass("ui-expandable-open")){$self.closeExpandable(event);}else{$self.openExpandable(event,options);}});this.closeExpandable=function(_event){$(".ui-expandable-icon",$title).removeClass(iconopenclass).addClass(iconclosedclass);$content.animate(options.animationClose,options.duration,options.easing,function(){$expandable.removeClass("ui-expandable-open");if(options.close){$self._close(_event,options);}});updateTextOptions({startopen:false});};this.openExpandable=function(_event,options){$(".ui-expandable-icon",$title).removeClass(iconclosedclass).addClass(iconopenclass);$content.animate(options.animationOpen,options.duration,options.easing,function(){$expandable.addClass("ui-expandable-open");if(options.open){$self._open(_event,options);}});updateTextOptions({startopen:true});};var updateTextOptions=function(values){if(options.textOptions){var currentValues;try{currentValues=JSON.parse($(options.textOptions).val());}catch(e){currentValues={};}currentValues=$.extend(currentValues,values);$(options.textOptions).val(JSON.stringify(currentValues));}};$title.hover(function(){$(this).removeClass("ui-state-default").addClass("ui-state-hover");},function(){$(this).removeClass("ui-state-hover").addClass("ui-state-default");});return this;});};$.fn.expandable.defaults={startopen:false,title:null,tooltip:"Click to expand",uiIconClosed:"ui-icon-triangle-1-e",uiIconOpen:"ui-icon-triangle-1-s",animationClose:{height:"hide"},animationOpen:{height:"show"},duration:500,easing:"swing",open:null,close:null,extraIcon:null,textOptions:null};})(jQuery);